<!-- does not work on mobile! -->
<!DOCTYPE HTML>
<html>
<head>
	<!-- Valiant360 styles -->
	<link rel="stylesheet" type="text/css" href="valiant360/css/valiant360.css">

	<!-- required libraries -->
	<script src="valiant360/js/jquery-1.7.2.min.js"></script>
	<script src="../../bower_components/threejs/build/three.js"></script>
	 
	<!-- Valiant360 plugin -->
	<script src="valiant360/jquery.valiant360.js"></script>
	<script type="text/javascript">
	WebVRConfig = {
	  FORCE_ENABLE_VR: true,
	  K_FILTER: 0.98, 
	  FORCE_DISTORTION: true,
	  MOUSE_KEYBOARD_CONTROLS_DISABLED: false,
	};
	</script>
	
	<script src="../../js/threejs-extras/VREffect.js"></script>
	<!-- WebVR Polyfill: a JavaScript implementation of the WebVR spec -->
	<script src="../../bower_components/webvr-polyfill/build/webvr-polyfill.js"></script>
	<!-- WebVR Boilerplate: A THREE.js-based starting point for VR experiences -->
	<script src="../../bower_components/webvr-boilerplate/build/webvr-manager.js"></script>
	<script src="webvr-manager-extras.js"></script>

</head>
<body>
	<!-- Valiant360 player container -->
	<div class="valiant" data-video-src="../../video/Overpass.mp4"></div>
	<script type="text/javascript">
		var video = null;
		var manager = null;
		var effect = null;
		var camera = null;
		var scene = null;
		var renderer = null;

		window.addEventListener( 'resize', onWindowResize, false );

		function onWindowResize(){
            $("body").css("width", window.innerWidth);
			$("body").css("height", window.innerHeight);
		}

		$(document).ready(function() {

				$("body").css("margin", 0);
				video = $(".valiant");
				video.css("width", window.innerWidth);
				video.css("height", window.innerHeight);

				//video.Valiant360( {muted: false, hideControls: true} );
				video.Valiant360( {muted: false} );
				video = video.data().plugin_Valiant360;
				// video.options.muted = false;
				renderer = video._renderer;

				effect = new THREE.VREffect( renderer );
				effect.setSize(window.innerWidth, window.innerHeight);
				manager = new WebVRManager(renderer, effect, {hideButton: false});


				video.animate = function animate(){
					// set our animate function to fire next time a frame is ready
		            requestAnimationFrame( this.animate.bind(this) );
		            
		            if( this._isVideo ) {
		                if ( this._video.readyState === this._video.HAVE_ENOUGH_DATA) {
		                    if(typeof(this._texture) !== "undefined" ) {
		                        var ct = new Date().getTime();
		                        if(ct - this._time >= 30) {
		                            this._texture.needsUpdate = true;
		                            this._time = ct;
		                        }
		                    }
		                }                
		            }

		            this._lat = Math.max( - 85, Math.min( 85, this._lat ) );
		            this._phi = ( 90 - this._lat ) * Math.PI / 180;
		            this._theta = this._lon * Math.PI / 180;

		            var cx = 500 * Math.sin( this._phi ) * Math.cos( this._theta );
		            var cy = 500 * Math.cos( this._phi );
		            var cz = 500 * Math.sin( this._phi ) * Math.sin( this._theta );

		            this._camera.lookAt(new THREE.Vector3(cx, cy, cz));

		            // distortion
		            if(this.options.flatProjection) {
		                this._camera.position.x = 0;
		                this._camera.position.y = 0;
		                this._camera.position.z = 0;
		            } else {
		                this._camera.position.x = - cx;
		                this._camera.position.y = - cy;
		                this._camera.position.z = - cz;
		            }

				 	manager.render( this._scene, this._camera );
				};
		});
	</script>

</body>
</html>